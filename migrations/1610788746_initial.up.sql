CREATE TABLE "actors" ("id" bigserial,"created_at" timestamptz,"updated_at" timestamptz,"deleted_at" timestamptz,"uri" text UNIQUE,"url" text,"type" text,"username" text,"domain" text,"name" text,"summary" text,"public_key" text,"followers_uri" text,"following_uri" text,"inbox_uri" text,"outbox_uri" text,PRIMARY KEY ("id"));
CREATE INDEX "idx_actors_deleted_at" ON "actors" ("deleted_at");
CREATE TABLE "follows" ("follower_id" bigint,"following_id" bigint,"created_at" timestamptz,"role" text,PRIMARY KEY ("follower_id","following_id"),CONSTRAINT "fk_follows_following" FOREIGN KEY ("following_id") REFERENCES "actors"("id"),CONSTRAINT "fk_follows_actor" FOREIGN KEY ("following_id") REFERENCES "actors"("id"),CONSTRAINT "fk_follows_followers" FOREIGN KEY ("follower_id") REFERENCES "actors"("id"),CONSTRAINT "fk_follows_follower" FOREIGN KEY ("follower_id") REFERENCES "actors"("id"));
CREATE TABLE "users" ("actor_id" bigint,"email" text UNIQUE,"encrypted_password" text,"private_key" text,"is_verified" boolean,"is_admin" boolean,"is_moderator" boolean,PRIMARY KEY ("actor_id"),CONSTRAINT "fk_users_actor" FOREIGN KEY ("actor_id") REFERENCES "actors"("id"),CONSTRAINT "fk_actors_user" FOREIGN KEY ("actor_id") REFERENCES "actors"("id"));
CREATE TABLE "categories" ("id" bigserial,"created_at" timestamptz,"updated_at" timestamptz,"deleted_at" timestamptz,"uri" text UNIQUE,"url" text,"type" text,"commune_id" bigint,"slug" text,PRIMARY KEY ("id"),CONSTRAINT "fk_categories_commune" FOREIGN KEY ("commune_id") REFERENCES "actors"("id"),CONSTRAINT "fk_actors_categories" FOREIGN KEY ("commune_id") REFERENCES "actors"("id"));
CREATE INDEX "idx_categories_deleted_at" ON "categories" ("deleted_at");
CREATE TABLE "posts" ("id" bigserial,"created_at" timestamptz,"updated_at" timestamptz,"deleted_at" timestamptz,"uri" text UNIQUE,"url" text,"type" text,"author_id" bigint,"category_id" bigint,"content" text,"media_type" text,"source" text,"source_media_type" text,"name" text,"reply_to_id" bigint,PRIMARY KEY ("id"),CONSTRAINT "fk_posts_author" FOREIGN KEY ("author_id") REFERENCES "actors"("id"),CONSTRAINT "fk_categories_posts" FOREIGN KEY ("category_id") REFERENCES "categories"("id"),CONSTRAINT "fk_posts_category" FOREIGN KEY ("category_id") REFERENCES "categories"("id"),CONSTRAINT "fk_posts_reply_to" FOREIGN KEY ("reply_to_id") REFERENCES "posts"("id"),CONSTRAINT "fk_actors_created_posts" FOREIGN KEY ("author_id") REFERENCES "actors"("id"));
CREATE INDEX "idx_posts_deleted_at" ON "posts" ("deleted_at")